<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
        integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">

    <link rel="stylesheet" href="style.css">
    <link rel="shortcut icon" href="images/yoda.ico" type="image/x-icon">
    <title>On A WebPage Far Far Away...</title>
</head>

<body>
    <div id="loader-wrapper">
        <div id="loader-img">CHOOSE A SIDE, YOU MUST!</div>
        <div id="loader"></div>

        <div class="loader-section section-left"></div>
        <div class="loader-section section-right"></div>

    </div>

    <div class="crawl-loaded-carrier">
        <div class="star-wars-crawler-wrapper">
            <div class="fade"></div>

            <section class="star-wars-crawler">
                <div class="star-wars">

                    <div class="crawl">

                        <div class="title text-center">
                            <p>Episode LXIX</p>
                            <h1>A New Age Of Dawn</h1>
                            <br>
                        </div>

                        <p>It is a period of a Pandemic. Rebel viruses, striking from a hidden base, have won their
                            first
                            victory
                            against the evil Human Empire.</p>
                        <p>During this tough times, A Rebel programmer managed to steal secret plans to enable Dark Mode
                            Integration in simple UI designs,
                            the
                            'filter property', which defines visual effects (like blur and saturation) to an element.
                        </p>
                        <p>Learn the ways of the force and to control CSS and JS through this demo until peace is
                            restored in the galaxy...</p>

                    </div>

                </div>
            </section>
            <button class="nxt-btn btn btn-lg btn-outline-warning p-auto">
                Next
            </button>
        </div>
    </div>

    <nav class="navbar navbar-expand-sm bg-dark navbar-dark d-flex flex-row justify-content-center inverted">
        <!-- Links -->
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link" href="#" id="toggle-music">Toggle Music</a>
            </li>
        </ul>
        <!-- Navbar text-->
        <span class="navbar-text text-white font-weight-bold">
            MAY THE FORCE BE WITH YOU
        </span>
    </nav>

    <section id="main-section" class="main-sec">
        <div class="text-center main-row d-flex flex-row flex-wrap justify-content-around">

            <div class="main-col d-flex align-items-center light-side-col">
                <div class="tile tile-focused">
                    <img src="images/anakin_lightsaber.jpg" alt="" class="inverted tile-img">
                </div>
            </div>

            <div class="toggle-force-side-div">

                <div class="light-side-div">
                    <img src="images/anakin.png" alt="" class="side-img ">
                    <audio src="audio/jedi.mp3" loop preload="auto" class="light-side-audio"></audio>
                </div>

                <div class="dark-side-div">
                    <img src="images/Darth-Vader-Transparent.png" alt="" class="side-img d-none inverted">
                    <audio src="audio/vader.mp3" loop preload="auto" class="dark-side-audio"></audio>
                </div>

            </div>

            <div class="toggle-btn-div d-flex align-items-center">
                <button class="toggle-btn">Toggle Force Side</button>

            </div>

            <div class="main-col d-flex align-items-center dark-side-col">
                <div class="tile not-focused">
                    <img src="images/darth_vader_lightsaber.jpg" alt="" class="inverted tile-img">
                </div>
            </div>
        </div>
    </section>

    <!-- <hr>

    <section id="info">
        <div class="info-main">
            Info Part
        </div>
    </section> -->

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
        integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
        integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"
        crossorigin="anonymous"></script>
    <script src="node_modules/howler/dist/howler.min.js"></script>

    <script>
        if (document.readyState == "loading") {
            document.addEventListener("DOMContentLoaded", ready);
        } else {
            ready();
        }

        function ready() {
            // storing the window size to check for mobile
            $(window).resize(function () {
                var windowWidth = $(window).width()
            });
            const intro_sound = new Howl({
                src: ['audio/title.mp3'],
                // html5: true,
                loop: false,
                // preload: true,
                // autoplay: true,
            });
            var title_id = intro_sound.play();

            // get the crawl div to check for animation end
            var crawl = document.getElementsByClassName('crawl')[0];
            setTimeout(() => {
                crawl.style.display = 'block'
                crawl.style.animation = 'crawl 60s linear'; // start the animation
            }, 3000)
            // Code for Chrome, Safari and Opera
            crawl.addEventListener("webkitAnimationEnd", endCrawlFunction);
            // Standard syntax
            crawl.addEventListener("animationend", endCrawlFunction);

            function endCrawlFunction(event) {
                // hide the text after done crawling and show a btn to see the website
                x = event.target;
                x.style.display = 'none';
                // show the btn
                var nxtBtn = document.getElementsByClassName('nxt-btn')[0];
                nxtBtn.style.visibility = 'visible';
                nxtBtn.style.opacity = 1;
                // add a listener to the btn
                nxtBtn.addEventListener('click', () => {
                    $('.crawl-loaded-carrier').addClass('crawl-loaded');
                    // stop the music if its playing
                    intro_sound.stop();
                    // storing id
                    var light_id = light_sound.play();
                    var dark_id = dark_sound.play();
                    dark_sound.fade(1, 0, 100);
                    var music_flag = 0;
                })
            }

            // Setup the new Howl.
            const light_sound = new Howl({
                src: ['audio/jedi.mp3'],
                // html5: true,
                loop: true,
                // preload: true,
                // autoplay: true,
            });
            const dark_sound = new Howl({
                src: ['audio/vader.mp3'],
                // html5: true,
                loop: true,
                // preload: true,
                // autoplay: true,
            });

            // add loaded class to body once music is loaded
            $('body').addClass('loaded');

            // getting all the elements
            var btn = document.getElementsByClassName('toggle-btn')[0];
            var flag = 0;

            btn.addEventListener('click', () => {
                // change the audio
                if (flag == 0) {
                    // stop current audio
                    light_sound.fade(1, 0, 1000);
                    // play the dark side and set flag =1 and vice versa for else
                    dark_sound.fade(0, 1, 1000);
                    flag = 1;
                    // if on mobile scroll to that div
                    if ($(window).width() <= 400) {
                        scroll_to_dark();
                    }
                } else {
                    dark_sound.fade(1, 0, 1000);
                    light_sound.fade(0, 1, 1000);
                    flag = 0;
                    if ($(window).width() <= 400) {
                        scroll_to_light();
                    }
                }
                // get the tiles and side imgs after toggling btn
                let tiles = document.getElementsByClassName('tile');
                let side_imgs = document.getElementsByClassName('side-img');
                console.log("b4 = ", tiles)
                // toggling every element
                document.documentElement.classList.toggle('dark-mode');
                // reverting the elements which are not supposed to invert
                document.querySelectorAll('.inverted').forEach((result) => {
                    result.classList.toggle('invert');
                })
                // blurring the unfocused tile
                for (let index = 0; index < tiles.length; index++) {
                    // using side imgs in this for loop coz the lentgh is same
                    tiles[index].classList.toggle('not-focused');
                    tiles[index].classList.toggle('tile-focused');
                    side_imgs[index].classList.toggle('d-none');
                }
            })

            var stop_music_btn = document.getElementById('toggle-music');
            stop_music_btn.addEventListener('click', () => {
                console.log('toggling-music');
                if (music_flag == 0) {
                    // stop music
                    Howler.mute(true);
                    music_flag = 1;
                } else {
                    Howler.mute(false);
                    music_flag = 0;
                }
            })

            function scroll_to_dark() {
                var $toElement = '.dark-side-col',
                    $focusElement = '.dark-side-col',
                    $offset = 200 * 1 || 0,
                    $speed = 700 * 1 || 500;

                $('html, body').animate({
                    scrollTop: $($toElement).offset().top + $offset
                }, $speed);

                if ($focusElement) $($focusElement).focus();
            }
            function scroll_to_light() {
                var $toElement = '.light-side-col',
                    $focusElement = '.light-side-col',
                    $offset = 10 * 1 || 0,
                    $speed = 700 * 1 || 500;

                $('html, body').animate({
                    scrollTop: $($toElement).offset().top + $offset
                }, $speed);

                if ($focusElement) $($focusElement).focus();
            }
        }
    </script>
</body>

</html>